{% extends "base.html" %}

{% block title %}Search{% if query %}: {{ query }}{% endif %} - AnimeStream{% endblock %}

{% block content %}
<h2 class="page-title">
    {% if query %}
    üîç Search Results: "{{ query }}"
    {% else %}
    üîç Search Anime
    {% endif %}
</h2>

{% if error %}
<div style="background: rgba(255,107,107,0.1); border: 1px solid #ff6b6b; border-radius: 8px; padding: 15px; margin-bottom: 20px; color: #ff6b6b;">
    <strong>‚ö†Ô∏è Error:</strong> {{ error }}
</div>
{% endif %}

{% if data %}
<p style="color: #999; margin-bottom: 20px;">Found {{ data|length }} result{{ 's' if data|length != 1 else '' }}</p>

<div class="anime-grid">
    {% for anime in data %}
    {# Use ID as fallback if URL is broken or empty #}
    {% set anime_link = anime.url if anime.url and anime.url != '' and anime.url != 'N/A' else anime.id %}
    
    <a href="/anime/{{ anime_link }}" style="text-decoration: none; color: inherit;">
        <div class="anime-card">
            {% if anime.lastch %}
            <span class="badge">{{ anime.lastch }}</span>
            {% elif anime.lastup %}
            <span class="badge">{{ anime.lastup }}</span>
            {% endif %}
            
            <img 
                src="{{ anime.cover }}" 
                alt="{{ anime.judul }}" 
                onerror="this.src='https://via.placeholder.com/180x260?text=No+Image'"
            >
            
            <div class="anime-card-info">
                <h3 title="{{ anime.judul }}">{{ anime.judul }}</h3>
                <div class="meta">
                    <span>‚≠ê {{ anime.score if anime.score and anime.score != 'N/A' else 'N/A' }}</span>
                    {% if anime.status %}
                    <span>{{ anime.status }}</span>
                    {% endif %}
                </div>
                {% if anime.total_episode %}
                <div class="meta" style="margin-top: 0.3rem;">
                    <span>üì∫ {{ anime.total_episode }} Eps</span>
                </div>
                {% endif %}
            </div>
        </div>
    </a>
    {% endfor %}
</div>

{% elif query %}
<div style="text-align: center; margin: 4rem 0;">
    <div style="font-size: 4rem; margin-bottom: 1rem;">üîç</div>
    <p style="font-size: 1.3rem; color: #999;">No results found for "{{ query }}"</p>
    <p style="color: #666; margin-top: 0.5rem;">Try searching with different keywords</p>
</div>
{% endif %}

<style>
/* Additional styles for search results */
.anime-card {
    position: relative;
}

.anime-card img {
    transition: transform 0.3s;
}

.anime-card:hover img {
    transform: scale(1.05);
}

.anime-card-info h3 {
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.meta {
    display: flex;
    justify-content: space-between;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.meta span {
    font-size: 0.75rem;
    background: rgba(255, 107, 107, 0.1);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
}
</style>

{% endblock %}
